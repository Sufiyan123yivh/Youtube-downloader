<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Downloader</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        .download-progress {
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .success-animation {
            animation: bounce 0.5s ease-in-out;
        }
        
        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% { transform: translateY(0); }
            40%, 43% { transform: translateY(-10px); }
            70% { transform: translateY(-5px); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-red-50 to-pink-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-2xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <div class="flex items-center justify-center mb-4">
                <div class="bg-red-500 p-3 rounded-full mr-3">
                    <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
                    </svg>
                </div>
                <h1 class="text-4xl font-bold text-gray-800">YouTube Downloader</h1>
            </div>
            <p class="text-gray-600 text-lg">Download YouTube videos as audio or video files</p>
        </div>

        <!-- Main Card -->
        <div class="bg-white rounded-2xl shadow-xl p-8 mb-6">
            <!-- URL Input -->
            <div class="mb-6">
                <label class="block text-sm font-semibold text-gray-700 mb-3">YouTube Video URL</label>
                <div class="relative">
                    <input 
                        type="url" 
                        id="videoUrl"
                        placeholder="https://www.youtube.com/watch?v=..."
                        class="w-full px-4 py-4 border-2 border-gray-200 rounded-xl focus:border-red-500 focus:outline-none transition-colors text-lg"
                    >
                    <button onclick="pasteUrl()" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-red-500 transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Download Type Selection -->
            <div class="mb-6">
                <label class="block text-sm font-semibold text-gray-700 mb-3">Download Type</label>
                <div class="grid grid-cols-2 gap-4">
                    <button onclick="selectDownloadType('audio')" id="audioTypeBtn" class="download-type-btn active flex items-center justify-center p-4 border-2 border-red-500 bg-red-50 text-red-700 rounded-xl font-semibold transition-all">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M9 12a3 3 0 106 0v5a3 3 0 11-6 0V7a3 3 0 016 0v5z"></path>
                        </svg>
                        Audio Only
                    </button>
                    <button onclick="selectDownloadType('video')" id="videoTypeBtn" class="download-type-btn flex items-center justify-center p-4 border-2 border-gray-200 bg-white text-gray-600 rounded-xl font-semibold transition-all hover:border-red-300">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                        </svg>
                        Video + Audio
                    </button>
                </div>
            </div>

            <!-- Format Selection -->
            <div id="formatOptions" class="grid md:grid-cols-2 gap-6 mb-6">
                <!-- Audio Options -->
                <div id="audioOptions">
                    <label class="block text-sm font-semibold text-gray-700 mb-3">Audio Format</label>
                    <select id="audioFormat" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-red-500 focus:outline-none transition-colors">
                        <option value="mp3">MP3 (Most Compatible)</option>
                        <option value="wav">WAV (Uncompressed)</option>
                        <option value="m4a">M4A (High Quality)</option>
                    </select>
                </div>
                
                <!-- Video Options -->
                <div id="videoOptions" class="hidden">
                    <label class="block text-sm font-semibold text-gray-700 mb-3">Video Format</label>
                    <select id="videoFormat" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-red-500 focus:outline-none transition-colors">
                        <option value="mp4">MP4 (Most Compatible)</option>
                        <option value="webm">WebM (Smaller Size)</option>
                    </select>
                </div>
                
                <!-- Quality Options -->
                <div id="qualityOptions">
                    <label class="block text-sm font-semibold text-gray-700 mb-3" id="qualityLabel">Audio Quality</label>
                    <select id="qualitySelect" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-red-500 focus:outline-none transition-colors">
                        <option value="best">Best Quality</option>
                        <option value="worst">Fastest Download</option>
                    </select>
                </div>
            </div>

            <!-- Video Preview -->
            <div id="videoPreview" class="hidden mb-6 p-6 bg-gradient-to-r from-gray-50 to-gray-100 rounded-xl border border-gray-200">
                <div class="flex items-start space-x-4">
                    <div class="w-32 h-20 bg-gradient-to-br from-red-400 to-pink-500 rounded-lg flex items-center justify-center shadow-md">
                        <svg class="w-10 h-10 text-white" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M8 5v14l11-7z"/>
                        </svg>
                    </div>
                    <div class="flex-1">
                        <h3 class="font-bold text-gray-800 text-lg mb-2" id="videoTitle">Loading...</h3>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div>
                                <p class="text-gray-500 font-medium">Duration</p>
                                <p class="text-gray-700" id="videoDuration">--:--</p>
                            </div>
                            <div>
                                <p class="text-gray-500 font-medium">Views</p>
                                <p class="text-gray-700" id="videoViews">-- views</p>
                            </div>
                            <div>
                                <p class="text-gray-500 font-medium">Channel</p>
                                <p class="text-gray-700" id="videoChannel">Loading...</p>
                            </div>
                            <div>
                                <p class="text-gray-500 font-medium">Upload Date</p>
                                <p class="text-gray-700" id="videoDate">--</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Download Button -->
            <button 
                onclick="startDownload()" 
                id="downloadBtn"
                class="w-full bg-gradient-to-r from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600 text-white font-semibold py-4 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 shadow-lg"
            >
                <span class="flex items-center justify-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    <span id="downloadBtnText">Download Audio</span>
                </span>
            </button>

            <!-- Progress Bar -->
            <div id="progressContainer" class="hidden mt-6">
                <div class="flex justify-between text-sm text-gray-600 mb-2">
                    <span id="progressText">Preparing download...</span>
                    <span id="progressPercent">0%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3">
                    <div id="progressBar" class="download-progress bg-gradient-to-r from-red-500 to-pink-500 h-3 rounded-full"></div>
                </div>
            </div>

            <!-- Success Message -->
            <div id="successMessage" class="hidden mt-6 p-4 bg-green-50 border border-green-200 rounded-xl">
                <div class="flex items-center">
                    <div class="success-animation">
                        <svg class="w-6 h-6 text-green-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                    </div>
                    <div>
                        <p class="text-green-800 font-semibold">Download Complete!</p>
                        <p class="text-green-600 text-sm" id="successText">Your file is ready</p>
                        <a id="downloadLink" href="#" download class="inline-block mt-2 bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                            Download File
                        </a>
                    </div>
                </div>
            </div>

            <!-- Error Message -->
            <div id="errorMessage" class="hidden mt-6 p-4 bg-red-50 border border-red-200 rounded-xl">
                <div class="flex items-center">
                    <svg class="w-6 h-6 text-red-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <div>
                        <p class="text-red-800 font-semibold">Download Failed</p>
                        <p class="text-red-600 text-sm" id="errorText">Please try again</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Features -->
        <div class="mt-8 grid md:grid-cols-3 gap-4">
            <div class="text-center p-4">
                <div class="bg-red-100 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-3">
                    <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                    </svg>
                </div>
                <h4 class="font-semibold text-gray-800 mb-1">Fast Downloads</h4>
                <p class="text-sm text-gray-600">Quick processing and download speeds</p>
            </div>
            
            <div class="text-center p-4">
                <div class="bg-green-100 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-3">
                    <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <h4 class="font-semibold text-gray-800 mb-1">High Quality</h4>
                <p class="text-sm text-gray-600">Multiple format and quality options</p>
            </div>
            
            <div class="text-center p-4">
                <div class="bg-purple-100 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-3">
                    <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                    </svg>
                </div>
                <h4 class="font-semibold text-gray-800 mb-1">Secure</h4>
                <p class="text-sm text-gray-600">Safe and private processing</p>
            </div>
        </div>
    </div>

    <script>
        let currentDownloadType = 'audio';

        function selectDownloadType(type) {
            currentDownloadType = type;
            
            const audioBtn = document.getElementById('audioTypeBtn');
            const videoBtn = document.getElementById('videoTypeBtn');
            const audioOptions = document.getElementById('audioOptions');
            const videoOptions = document.getElementById('videoOptions');
            const qualityLabel = document.getElementById('qualityLabel');
            const downloadBtnText = document.getElementById('downloadBtnText');
            
            if (type === 'audio') {
                audioBtn.className = 'download-type-btn active flex items-center justify-center p-4 border-2 border-red-500 bg-red-50 text-red-700 rounded-xl font-semibold transition-all';
                videoBtn.className = 'download-type-btn flex items-center justify-center p-4 border-2 border-gray-200 bg-white text-gray-600 rounded-xl font-semibold transition-all hover:border-red-300';
                
                audioOptions.classList.remove('hidden');
                videoOptions.classList.add('hidden');
                
                qualityLabel.textContent = 'Audio Quality';
                downloadBtnText.textContent = 'Download Audio';
            } else {
                videoBtn.className = 'download-type-btn active flex items-center justify-center p-4 border-2 border-red-500 bg-red-50 text-red-700 rounded-xl font-semibold transition-all';
                audioBtn.className = 'download-type-btn flex items-center justify-center p-4 border-2 border-gray-200 bg-white text-gray-600 rounded-xl font-semibold transition-all hover:border-red-300';
                
                videoOptions.classList.remove('hidden');
                audioOptions.classList.add('hidden');
                
                qualityLabel.textContent = 'Video Quality';
                downloadBtnText.textContent = 'Download Video';
            }
        }

        async function pasteUrl() {
            try {
                const text = await navigator.clipboard.readText();
                document.getElementById('videoUrl').value = text;
                if (text.includes('youtube.com') || text.includes('youtu.be')) {
                    await fetchVideoInfo(text);
                }
            } catch (err) {
                console.log('Could not paste from clipboard');
            }
        }

        async function fetchVideoInfo(url) {
            try {
                const response = await fetch('/api/info', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ url })
                });

                if (response.ok) {
                    const info = await response.json();
                    showVideoPreview(info);
                }
            } catch (error) {
                console.error('Error fetching video info:', error);
            }
        }

        function showVideoPreview(info) {
            const preview = document.getElementById('videoPreview');
            preview.classList.remove('hidden');
            
            document.getElementById('videoTitle').textContent = info.title || 'Unknown Title';
            document.getElementById('videoDuration').textContent = formatDuration(info.duration) || '--:--';
            document.getElementById('videoViews').textContent = info.view_count ? `${info.view_count.toLocaleString()} views` : '-- views';
            document.getElementById('videoChannel').textContent = info.uploader || 'Unknown Channel';
            document.getElementById('videoDate').textContent = formatDate(info.upload_date) || '--';
        }

        function formatDuration(seconds) {
            if (!seconds) return '--:--';
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function formatDate(dateString) {
            if (!dateString) return '--';
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString();
            } catch {
                return dateString;
            }
        }

        async function startDownload() {
            const url = document.getElementById('videoUrl').value;
            const btn = document.getElementById('downloadBtn');
            const progressContainer = document.getElementById('progressContainer');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const progressPercent = document.getElementById('progressPercent');
            const successMessage = document.getElementById('successMessage');
            const errorMessage = document.getElementById('errorMessage');

            if (!url) {
                alert('Please enter a YouTube URL');
                return;
            }

            // Reset UI
            btn.disabled = true;
            btn.innerHTML = '<span class="flex items-center justify-center"><svg class="animate-spin w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>Processing...</span>';
            progressContainer.classList.remove('hidden');
            successMessage.classList.add('hidden');
            errorMessage.classList.add('hidden');

            try {
                const format = currentDownloadType === 'audio' ? 
                    document.getElementById('audioFormat').value : 
                    document.getElementById('videoFormat').value;
                
                const quality = document.getElementById('qualitySelect').value;

                // Simulate progress
                let progress = 0;
                const progressInterval = setInterval(() => {
                    progress += Math.random() * 15;
                    if (progress > 90) progress = 90;
                    
                    progressBar.style.width = progress + '%';
                    progressPercent.textContent = Math.round(progress) + '%';
                    
                    if (progress < 30) {
                        progressText.textContent = 'Fetching video information...';
                    } else if (progress < 60) {
                        progressText.textContent = currentDownloadType === 'audio' ? 'Extracting audio...' : 'Processing video...';
                    } else {
                        progressText.textContent = `Converting to ${format.toUpperCase()}...`;
                    }
                }, 200);

                const response = await fetch('/api/download', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        url,
                        type: currentDownloadType,
                        format,
                        quality
                    })
                });

                clearInterval(progressInterval);

                if (response.ok) {
                    const blob = await response.blob();
                    const downloadUrl = window.URL.createObjectURL(blob);
                    
                    // Complete progress
                    progressBar.style.width = '100%';
                    progressPercent.textContent = '100%';
                    progressText.textContent = 'Download complete!';
                    
                    setTimeout(() => {
                        progressContainer.classList.add('hidden');
                        successMessage.classList.remove('hidden');
                        
                        const downloadLink = document.getElementById('downloadLink');
                        downloadLink.href = downloadUrl;
                        downloadLink.download = `youtube-download.${format}`;
                        
                        document.getElementById('successText').textContent = `Your ${currentDownloadType} file is ready`;
                    }, 1000);
                } else {
                    const error = await response.json();
                    throw new Error(error.error || 'Download failed');
                }
            } catch (error) {
                progressContainer.classList.add('hidden');
                errorMessage.classList.remove('hidden');
                document.getElementById('errorText').textContent = error.message;
            } finally {
                btn.disabled = false;
                btn.innerHTML = `<span class="flex items-center justify-center"><svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg><span id="downloadBtnText">${currentDownloadType === 'audio' ? 'Download Audio' : 'Download Video'}</span></span>`;
            }
        }

        // Auto-detect YouTube URLs
        document.getElementById('videoUrl').addEventListener('input', async function(e) {
            const url = e.target.value;
            if (url.includes('youtube.com') || url.includes('youtu.be')) {
                setTimeout(() => fetchVideoInfo(url), 1000);
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96fa12ceb1f63c3c',t:'MTc1NTI3NTM5NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
